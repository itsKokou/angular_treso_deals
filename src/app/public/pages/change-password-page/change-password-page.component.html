<div class="w-full max-w-screen-xl px-6 py-6 mx-auto">
  <!-- row 1  en tete overwiers-->
  <div class="flex flex-wrap -mx-3 " style="margin-left: 10%;">
    
  </div>
    <!-- row 2  Graphes-->
  <div class="flex mt-12 justify-center" >
        <div class=" px-3 mt-0 lg:flex-none w-2/3 "  >
            <div class="border-black/12.5 shadow-soft-xl relative z-20 flex min-w-0 flex-col break-words rounded-2xl border-0 border-solid bg-white bg-clip-border">
                <div class="border-black/12.5 mb-0 rounded-t-2xl border-b-0 border-solid bg-white p-6 pb-0" style="height: 10vh; background-color: #4D44B5;">
                    <div class=" top-4 absolute end-10 text-white">
                        <h3>Changement de mot de passe</h3>
                    </div>
                    <div class="flex justify-center items-center" style="height: 250%; background-color: white; border-radius: 100%; width: 15%;">
                        <img class="w-10/12 h-4/5  rounded-full" src="assets/img/logo1.png" alt="user" >
                    </div>
                </div>
                <div class="flex-auto p-4  mt-14 colorTraderPorfil " >
                <h1 class="text-3xl text-gray-800">{{connectedUser?.firstName +" "+connectedUser?.lastName}}</h1>
                <div class="flex justify-between my-2 " >
                    <div class="w-1/3 p-4" style=" width: 33%;">
                    <div class="flex flex-row -mx-3 items-center ">
                        <!--<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="text-white border border-orange-500 rounded-full bg-orange-500 p-1 h-7 w-7 " >
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                        </svg>-->
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="text-white border border-orange-500 rounded-full bg-orange-500 p-1 h-7 w-7 ">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.62 48.62 0 0 1 12 20.904a48.62 48.62 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.636 50.636 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.903 59.903 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" />
                        </svg>

                        <div class="px-2">
                        <p class="text-base font-semibold text-gray-700">{{connectedUser?.profile}}</p>
                        </div>
                    </div>
                    </div>

                    <div class="w-1/3 p-4" style=" width: 33%;">
                    <div class="flex flex-row -mx-3 items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="text-white border border-orange-500 rounded-full bg-orange-500 p-1 h-7 w-7 " >
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" />
                        </svg>
                        <div class="px-2">
                            <p class="text-base font-semibold text-gray-700">{{connectedUser?.phoneNumber}}</p>
                        </div>
                    </div>
                    </div>

                    <div class="w-1/3 p-4" style=" width: 33%;">
                    <div class="flex flex-row -mx-3 items-center ">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="text-white border border-orange-500 rounded-full bg-orange-500 p-1 h-7 w-7 " >
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                        </svg>
                        <div class="px-2">
                        <p class="text-base font-semibold text-gray-700">{{connectedUser?.email}}</p>
                        </div>
                    </div>
                    </div>
                </div>

                <div class="flex mb-4">
                    <p class=" text-base text-medium text-gray-700" >Institution :</p>
                    <p class="ml-4 text-base font-semibold text-gray-700" >{{connectedUser?.institutionName}}</p>
                </div>
                <div class="flex mb-4">
                    <p class=" text-base text-medium text-gray-700" >Date d'adh√©sion :</p>
                    <p class="ml-4 text-base font-semibold text-gray-700" >{{connectedUser?.createdAt | date:'dd/MM/yyyy'}}</p>
                </div>

                <form *ngIf="!isPasswordChanged" [formGroup]="form" (ngSubmit)="onSubmit()" class=" w-full mt-8 mb-2" > 
                    <div class="w-full justify-between" >
                    <div class="flex w-full items-start" >
                        <p class="text-base  text-gray-700 font-semibold text-start bg-white ">Changement de mot de passe :</p>  
                        <div class="ml-6">  
                            <div class="relative w-full">
                                <div class="absolute inset-y-0 end-0 flex items-center pe-3 z-10">
                                    <svg *ngIf="!isAncienPasswordVisible" (click)="toggleAncienPassword(ancienPasswordField)" class="w-4 h-4 z-20 cursor-pointer text-gray-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                        <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
                                    </svg>
                                    <svg *ngIf="isAncienPasswordVisible" (click)="toggleAncienPassword(ancienPasswordField)" class="w-4 h-4 z-20 cursor-pointer text-gray-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM22.676 12.553a11.249 11.249 0 0 1-2.631 4.31l-3.099-3.099a5.25 5.25 0 0 0-6.71-6.71L7.759 4.577a11.217 11.217 0 0 1 4.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113Z" />
                                        <path d="M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0 1 15.75 12ZM12.53 15.713l-4.243-4.244a3.75 3.75 0 0 0 4.244 4.243Z" />
                                        <path d="M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 0 0-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 0 1 6.75 12Z" />
                                    </svg>
                                </div>
                                <input formControlName="old_password" type="password" id="name" #ancienPasswordField name="name" required class="bg-gray-50 border border-gray-300 text-gray-900 placeholder:text-gray-400 placeholder:font-medium text-base rounded-md focus:ring-blue-500 focus:border-blue-500 block w-full py-1.5 pl-3 pr-8" placeholder="Ancien Mot de passe :">  
                            </div>
                            @if(old_password.errors && (old_password.dirty || old_password.touched)){
                                @if(old_password.getError("required")){
                                    <p class="text-left text-sm " style="color: red;">Ancien mot de passe requis</p>
                                }
                            }
                        </div>  
                    </div>
                    <hr style="background-color: #4D44B5; height: 0.1vh;">
                    <div class="flex items-start">
                        <div>
                        <div class="flex">
                            <div class="w-1/2 mr-5">
                                <div class="relative w-full">
                                    <div class="absolute inset-y-0 end-0 flex items-center pe-3 z-10">
                                        <svg *ngIf="!isNouveauPasswordVisible" (click)="toggleNouveauPassword(nouveauPasswordField)" class="w-4 h-4 z-20 cursor-pointer text-gray-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                            <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
                                        </svg>
                                        <svg *ngIf="isNouveauPasswordVisible" (click)="toggleNouveauPassword(nouveauPasswordField)" class="w-4 h-4 z-20 cursor-pointer text-gray-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM22.676 12.553a11.249 11.249 0 0 1-2.631 4.31l-3.099-3.099a5.25 5.25 0 0 0-6.71-6.71L7.759 4.577a11.217 11.217 0 0 1 4.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113Z" />
                                            <path d="M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0 1 15.75 12ZM12.53 15.713l-4.243-4.244a3.75 3.75 0 0 0 4.244 4.243Z" />
                                            <path d="M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 0 0-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 0 1 6.75 12Z" />
                                        </svg>
                                    </div>
                                    <input formControlName="new_password" type="password" id="pass1" #nouveauPasswordField name="name" required class="bg-gray-50 border border-gray-300 text-gray-900 placeholder:text-gray-400 placeholder:font-medium text-base rounded-md focus:ring-blue-500 focus:border-blue-500 block w-full py-1.5 pl-3 pr-8" placeholder="Nouveau mot de passe:">  
                                </div>
                                @if(new_password.errors && (new_password.dirty || new_password.touched)){
                                    @if(new_password.getError("required")){
                                        <p class="text-left text-sm " style="color: red;">Nouveau mot de passe requis</p>
                                    }
                                    @if(new_password.getError("notmaj")){
                                        <p class="text-left text-sm " style="color: red;">Au moins 1 caract√®re majuscule</p>
                                    }
                                    @if(new_password.getError("notminus")){
                                        <p class="text-left text-sm " style="color: red;">Au moins 1 caract√®re miniscule</p>
                                    }
                                    @if(new_password.getError("notspecial")){
                                        <p class="text-left text-sm " style="color: red;">Au moins 1 caract√®re sp√©cial</p>
                                    }
                                    @if(new_password.getError("notnumber")){
                                        <p class="text-left text-sm " style="color: red;">Au moins 1 caract√®re num√©rique</p>
                                    }
                                    @if(new_password.getError("isspace")){
                                        <p class="text-left text-sm " style="color: red;">Invalide ! Retirez les espaces</p>
                                    }
                                    @if(new_password.getError("pattern") && !(new_password.getError("notmaj") || new_password.getError("notminis") || new_password.getError("notnumber") || new_password.getError("notspecial") || new_password.getError("isspace"))){
                                        <p class="text-left text-sm " style="color: red;">Le mot de passe doit contenir au moins 5 caract√®res.</p>
                                    }
                                }
                            </div>
                            <div class="w-1/2">
                                <div class="relative w-full">
                                    <div class="absolute inset-y-0 end-0 flex items-center pe-3 z-10">
                                        <svg *ngIf="!isConfirmPasswordVisible" (click)="toggleConfirmPassword(confirmPasswordField)" class="w-4 h-4 z-20 cursor-pointer text-gray-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                                            <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd" />
                                        </svg>
                                        <svg *ngIf="isConfirmPasswordVisible" (click)="toggleConfirmPassword(confirmPasswordField)" class="w-4 h-4 z-20 cursor-pointer text-gray-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M3.53 2.47a.75.75 0 0 0-1.06 1.06l18 18a.75.75 0 1 0 1.06-1.06l-18-18ZM22.676 12.553a11.249 11.249 0 0 1-2.631 4.31l-3.099-3.099a5.25 5.25 0 0 0-6.71-6.71L7.759 4.577a11.217 11.217 0 0 1 4.242-.827c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113Z" />
                                            <path d="M15.75 12c0 .18-.013.357-.037.53l-4.244-4.243A3.75 3.75 0 0 1 15.75 12ZM12.53 15.713l-4.243-4.244a3.75 3.75 0 0 0 4.244 4.243Z" />
                                            <path d="M6.75 12c0-.619.107-1.213.304-1.764l-3.1-3.1a11.25 11.25 0 0 0-2.63 4.31c-.12.362-.12.752 0 1.114 1.489 4.467 5.704 7.69 10.675 7.69 1.5 0 2.933-.294 4.242-.827l-2.477-2.477A5.25 5.25 0 0 1 6.75 12Z" />
                                        </svg>
                                    </div>
                                    <input formControlName="confirm_password" type="password" id="pass2" #confirmPasswordField name="name" required class="bg-gray-50 border border-gray-300 text-gray-900 placeholder:text-gray-400 placeholder:font-medium text-base rounded-md focus:ring-blue-500 focus:border-blue-500 block w-full py-1.5 pl-3 pr-8" placeholder="Nouveau mot de passe:">  
                                </div>
                                @if(confirm_password.errors && (confirm_password.dirty || confirm_password.touched)){
                                    @if(confirm_password.getError("required")){
                                        <p class="text-left text-sm " style="color: red;">Confirmer le mot de passe</p>
                                    }
                                    @if(confirm_password.getError("notmaj")){
                                        <p class="text-left text-sm " style="color: red;">Au moins 1 caract√®re majuscule</p>
                                    }
                                    @if(confirm_password.getError("notminis")){
                                        <p class="text-left text-sm " style="color: red;">Au moins 1 caract√®re miniscule</p>
                                    }
                                    @if(confirm_password.getError("notspecial")){
                                        <p class="text-left text-sm " style="color: red;">Au moins 1 caract√®re sp√©cial</p>
                                    }
                                    @if(confirm_password.getError("notnumber")){
                                        <p class="text-left text-sm " style="color: red;">Au moins 1 caract√®re num√©rique</p>
                                    }
                                    @if(confirm_password.getError("isspace")){
                                        <p class="text-left text-sm " style="color: red;">Invalide ! Retirez les espaces</p>
                                    }
                                    @if(confirm_password.getError("pattern") && !(confirm_password.getError("notmaj") || confirm_password.getError("notminis") || confirm_password.getError("notnumber") || confirm_password.getError("notspecial") || confirm_password.getError("isspace"))){
                                        <p class="text-left text-sm " style="color: red;">Le mot de passe doit contenir au moins 5 caract√®res.</p>
                                    }
                                }
                                </div>
                            </div>
                            <div class="text-left text-sm mt-1" style="color: red;" 
                                *ngIf="form.getError('passwordMismatch')">
                                Les mots de passe ne correspondent pas
                            </div>
                        </div>
                        <div class="ml-8">  
                            <button type="submit" class="text-white bg-green-500 hover:bg-green-700 text-sm font-semibold px-5 py-1.5 text-center rounded focus:ring-0 focus:outline-none">Valider</button>
                        </div>  
                    </div>  
                    </div>
                </form> 

                <div *ngIf="isPasswordChanged" class="mb-2">
                    <hr style="background-color: #4D44B5; height: 0.1vh;">
                    <div class="flex justify-end pr-8">
                        <button type="button" (click)="goToCGU()" class="text-white bg-blue-700 hover:bg-blue-900 text-sm font-semibold px-5 py-1.5 text-center rounded focus:ring-0 focus:outline-none">Poursuivre</button>
                    </div>
                </div>
                </div>
            </div>
        </div>
  </div>
</div>



<!-- SPINNER  -->
<button id="openSpinner" data-modal-target="spinner-modal" data-modal-toggle="spinner-modal" class="hidden" type="button">
  Toggle Spinner
</button>

<button  id="closeSpinner" data-modal-hide="spinner-modal" type="button" class="hidden">
  Fermer
</button>

<div id="spinner-modal" data-modal-backdrop="static" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
  <div class="relative p-4 w-full max-w-2xl max-h-full">
    <div class="relative bg-transparent">
      <div class="flex justify-center items-center p-4">
        <mat-spinner></mat-spinner>
      </div>
    </div>
  </div>
</div>
